name: Refresh Instance
on: push
#    branches: 
#     - main
#      - 'refs/heads/feature2'
      
#  pull_request:
#    branches:
#      - main

jobs:
  refresh-autoscale:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.7'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install awscli
      #- run: aws autoscaling start-instance-refresh --auto-scaling-group-name tribehealth-platform
       # env:
        #  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
         # AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          #AWS_DEFAULT_REGION: "us-west-2"
  main-test:
      runs-on: ubuntu-latest
      needs: refresh-autoscale
      if: github.ref_name == 'main'
      steps:
        - name: Feature 1
          run: echo "Inside main branch"
  feature1-test:
      runs-on: ubuntu-latest
      needs: refresh-autoscale
      if: github.ref_name == 'feature1'
      steps:
        - name: Feature 1
          run: echo "Inside feature1 branch"
  feature2-test:
    runs-on: ubuntu-latest
    needs: refresh-autoscale
    if: github.ref_name == 'feature2'
    steps:
      - name: Feature 2
        run: echo "Inside feature2 branch"
  feature3-test:
    runs-on: ubuntu-latest
    needs: refresh-autoscale
    if: github.ref_name == 'feature3'
    steps:
      - name: Feature 3
        run: echo "Inside feature3 branch"


  
  
